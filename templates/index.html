<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>網頁圖片抓取器</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>網頁圖片抓取器</h1>
        <div class="input-section">
            <input type="url" id="urlInput" placeholder="請輸入網址 (例如：https://example.com)" required>
            <button onclick="fetchImages()">抓取圖片</button>
        </div>
        <div id="loading" class="loading" style="display: none;">載入中...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="imageContainer" class="image-container"></div>
    </div>

    <script>
        async function fetchImages() {
            const urlInput = document.getElementById('urlInput');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const imageContainer = document.getElementById('imageContainer');

            if (!urlInput.value) {
                error.textContent = '請輸入網址';
                error.style.display = 'block';
                return;
            }

            // 確保 URL 包含協議
            let url = urlInput.value;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
                urlInput.value = url;
            }

            loading.style.display = 'block';
            error.style.display = 'none';
            imageContainer.innerHTML = '';

            try {
                const formData = new FormData();
                formData.append('url', url);

                const response = await fetch('/fetch_images', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    if (data.images.length === 0) {
                        error.textContent = '未找到任何圖片';
                        error.style.display = 'block';
                    } else {
                        data.images.forEach(imageUrl => {
                            const img = document.createElement('img');
                            img.src = imageUrl;
                            img.alt = '抓取的圖片';
                            img.onerror = () => {
                                img.style.display = 'none';
                            };
                            imageContainer.appendChild(img);
                        });
                    }
                } else {
                    error.textContent = data.error || '發生錯誤';
                    error.style.display = 'block';
                }
            } catch (err) {
                error.textContent = '無法連接到伺服器，請確認伺服器是否正在運行';
                error.style.display = 'block';
                console.error('Error:', err);
            } finally {
                loading.style.display = 'none';
            }
        }

        // 添加按 Enter 鍵提交功能
        document.getElementById('urlInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                fetchImages();
            }
        });
    </script>
</body>
</html> 